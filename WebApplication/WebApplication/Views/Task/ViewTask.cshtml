@model WebApplication.Models.ViewTaskModel

@{
    ViewBag.Title = "View Task";
}

<h2>View Task</h2>
<div id="taskTags"></div>
<div id="Rate"></div>
<div id="Count">Count  @ViewBag.Count</div>
<div>
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Complexity)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Complexity)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Category)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Category)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Condition)
        </dt>

        <dd>
            @Html.Raw(Model.Condition)

            @if (ViewBag.IsSolved == false)
            {
                <input type="text" placeholder="Your Answer" id="answer">
                <div id="answerZone"></div>
                <button class="btn-default" id="AnswerSubmit">Ответить</button>
            }
            else
            {
                <div>Ты это решал уже</div>
            }
            <input type="text" placeholder="Your Comment" id="comment">
            <button class="btn-default" id="CommentSubmit">Добавить</button>
            <button class="btn-default" id="UpdateComment">Обновить</button>
            <div id="comments"></div>
            @if (ViewBag.IsRate == true)
            {
                <input type="number" placeholder="Set Rate" id="rate">
                <button class="btn-default" id="RateSubmit">Проголосовать</button>
            }
        </dd>

    </dl>
</div>

<script>
    $(document).ready(function () {
        $.ajax({
            type: "Post",
            url: '@Url.Action("GetTagsById", "Tag")',
            data:
            { 
                tagsStringId: '@string.Join("%",@Model.TagsId)',
                splitElement : "%"
            },
            success: function (data) {
                $('#taskTags').html(data);
            }
        });
        $.ajax({
            type: "Post",
            url: '@Url.Action("GetRate", "Rate")',
            data:
            {
                taskId: '@Model.Id',
            },
            success: function (data) {
                $('#Rate').html(data);
            }
        });
   });
    $('#AnswerSubmit').click(function () {
       $.ajax({
            type:"Post",
            url: '@Url.Action("CheckAnswer","Answer")',
            data: {
                taskId: '@Model.Id',
                answer: $('#answer').val()
            },
            success: function (data) {
                if (data == 'True') {
                    console.log(1);
                    var element = document.createElement("span");
                    element.className = "glyphicon glyphicon-ok"
                    $('#answerZone').html(element);
                    $('#answer').hide();
                    $('#AnswerSubmit').hide();

                }
                else {
                    var element = document.createElement("span");
                    element.className = "glyphicon glyphicon-remove"
                    $('#answerZone').html(element);
                }
            }
        })
    })

    $('#CommentSubmit').click(function () {
        $.ajax({
            type: "Post",
            url: '@Url.Action("CreateComment", "Comment")',
            data: {
                taskId: '@Model.Id',
                text: $('#comment').val()
            },
            success: function (data) {
                if (data == "True") {
                }
            }
        })
    });
    $('#UpdateComment').click(function () {
        $.ajax({
            type: "Post",
            url: '@Url.Action("GetTaskComment", "Comment")',
            data: {
                taskId: '@Model.Id'
            },
            success: function(data) {
                $('#comments').html(data);
            }
        });
    });
    $('#RateSubmit').click(function () {
        $.ajax({
            type: "Post",
            url: '@Url.Action("UpdateRate", "Rate")',
            data: {
                taskId: '@Model.Id',
                rate: $('#rate').val()
            },
            success: function (data) {
                $('#rate').hide();
                $('#RateSubmit').hide();
            }
        })
    });


</script>